function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},o={},r=t.parcelRequiree178;null==r&&((r=function(e){if(e in i)return i[e].exports;if(e in o){var t=o[e];delete o[e];var r={id:e,exports:{}};return i[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){o[e]=t},t.parcelRequiree178=r),r.register("hmw8t",(function(e,t){e.exports=["https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/presentations"]}));var n;n=()=>{try{return localStorage.setItem("test","test"),localStorage.removeItem("test","test"),sessionStorage.setItem("test","test"),sessionStorage.removeItem("test","test"),!0}catch(e){return!1}};var a,l,s=r("gV68j"),c=r("ccTqr"),d=r("3AbJ1"),u={};u=TrelloPowerUp.util.makeErrorEnum("GoogleDrive",["Unauthorized","NotFound","Unknown","Cancelled","RateLimited"]);const{Promise:g}=TrelloPowerUp,m={401:u.Unauthorized,403:u.Unauthorized,404:u.NotFound};l=(t,i)=>g.resolve(t).catch((t=>{if(t){let i,o;try{o=JSON.parse(t.body),i=e(d).get(o,"error.message")}catch(e){}if(403===t.status&&o&&"usageLimits"===e(d).get(o,"error.errors[0].domain"))throw console.warn("Rate Limited!"),new u.RateLimited(i);throw((e,t)=>new(m[e]||u.Unknown)(t))(t.status,i)}throw i?new i:new u.Unknown}));var p,h;const{Promise:w}=TrelloPowerUp,f=async e=>{let t;try{t=await e.get("member","private","refresh")}catch(e){window.Sentry.captureException(e)}if(!t)throw new u.Unauthorized("Load Secret Failure");const i=await fetch("./refresh",{method:"POST",headers:{Authorization:`bearer ${t}`}});if(!i.ok)throw e.remove("member","private","refresh"),new u.Unauthorized("Refresh Failure");const o=await i.json();return sessionStorage.setItem("access_token",o.access_token),sessionStorage.setItem("id_token",o.id_token),sessionStorage.setItem("token_expiry",Date.now()+1e3*o.expires_in),o.access_token};h=e=>w.try((async()=>{let t;try{t=sessionStorage.getItem("access_token")}catch(e){throw new u.Unauthorized("SessionStorage Access Denied")}if(t){const i=sessionStorage.getItem("token_expiry");return Date.now()>parseInt(i,10)?f(e):t}return f(e)}));var y,v;v=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];const z=r("hmw8t").join(" "),{Promise:_}=TrelloPowerUp;window.gapiReady=null,y=new _((e=>{window.gapiReady=()=>{gapi.load("client:auth2",(()=>{gapi.client.init({clientId:"122616814543-hsdqkh69lmt11uou701693iq4k6tcu61.apps.googleusercontent.com",discoveryDocs:v,scope:z}).then((()=>{e(gapi)}),(()=>{}))})),window.gapiReady=null}}));const{Promise:b}=TrelloPowerUp;p=e=>b.try((async()=>{const t=await y,i=await h(e);if(!i)throw new u.Unauthorized;return t.client.setToken({access_token:i}),t}));var k=r("3k6sy");e(c).addPlugin(e(s));const{Promise:U}=TrelloPowerUp;a=(t,i,o)=>U.try((()=>{const r=k.parse(i);return r.isGoogleDriveUrl?U.try((async()=>{if(!r.isFile&&!r.isFolder)return null;const i=e(c).get(r.id);if(i)return i;const o=await p(t);return(await l(o.client.drive.files.get({fields:"kind,id,name,teamDriveId,mimeType,trashed,explicitlyTrashed,webContentLink,webViewLink,iconLink,hasThumbnail,thumbnailLink,createdTime,modifiedTime,lastModifyingUser,size",fileId:r.id,supportsTeamDrives:!0}))).result})).then((t=>{if(null==t)return null;e(c).set(t.id,t,Date.now()+3e5);const i={image:{url:t.thumbnailLink,logo:!t.thumbnailLink,y:"top",size:"contain"},title:t.name,contentLink:t.webContentLink,size:t.size,created:Date.parse(t.createdTime),modified:Date.parse(t.modifiedTime),description:t.description,mimeType:t.mimeType,isFolder:r.isFolder};return t.lastModifyingUser&&t.lastModifyingUser.displayName&&(i.modifiedBy=t.lastModifyingUser.displayName),i})).catch(u.Unauthorized,(()=>({image:{url:"./images/icon.svg",logo:!0},title:o||i,uninitialized:!0}))).catch((()=>{throw t.NotHandled()})):null}));var T;k=r("3k6sy");T={defaultLocale:"en",supportedLocales:["cs","de","en","es","fi","fr","hu","it","ja","nb","nl","pl","pt-BR","ru","sv","th","tr","uk","vi","zh-Hans","zh-Hant"],resourceUrl:"./strings/6c60888e93eb/{locale}.json"};var K;K=e=>{const t=[" Bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"];for(let i=1;i<t.length;i++)if(e<Math.pow(1024,i))return Math.round(e/Math.pow(1024,i-1)*100)/100+t[i-1];return e};const{Promise:x}=TrelloPowerUp;TrelloPowerUp.initialize({"attachment-sections":(e,t)=>{if(!e.isMemberSignedIn())return[];const{entries:i}=t,o=i.filter((e=>k.isFolder(e.url)));return 0===o.length?[]:x.map(o,(t=>{const i=a(e,t.url,t.name).get("title").catch((()=>t.name||e.localizeKey("google_drive_folder")));return{id:t.id,claimed:[t],icon:"./images/icon.svg",title:()=>i,content:{type:"iframe",url:e.signUrl("./folder.html",{url:t.url})}}}))},"attachment-thumbnail":(e,t)=>x.try((async()=>{if(!e.isMemberSignedIn())throw e.NotHandled();let i;try{i=await a(e,t.url,t.name)}catch(e){}if(null==i)throw e.NotHandled();if(i.url=t.url,i.openText=e.localizeKey("open_in_google_drive"),i.image.url||(i.image.url="./images/icon.svg"),i.uninitialized){if(!n())throw e.NotHandled();i.initialize={type:"iframe",url:e.signUrl(TrelloPowerUp.util.relativeUrl("authorize-link.html"))}}return i})),"board-buttons":e=>[{icon:"./images/icon.svg",text:e.localizeKey("google_drive"),callback:e=>{const t=e=>e.popup({title:e.localizeKey("google_drive"),items:[{text:e.localizeKey("create_slides_presentation"),callback:e=>e.popup({title:e.localizeKey("generating_presentation"),url:"create-presentation.html",height:40})}]});return h(e).then((()=>t(e))).catch(u.Unauthorized,(()=>e.popup({title:e.localizeKey("authorize"),url:"authorize.html",callback:e=>t(e)})))}}],"card-buttons":e=>e.memberCanWriteToModel("card")?[{icon:"./images/icon.svg",text:e.localizeKey("google_drive"),callback:e=>e.popup({title:e.localizeKey("google_drive"),url:"card-menu.html",height:96})}]:[],"format-url":async(e,t)=>{if(!k.parse(t.url).isGoogleDriveUrl)throw e.NotHandled("Not a formattable URL");const i=await a(e,t.url);if(!i)throw e.NotHandled("Error retrieving data from URL");const{title:o,image:r,contentLink:n,size:l,mimeType:s,uninitialized:c,isFolder:d}=i;if(c)return{icon:"./images/icon.svg",text:t.url};if(d)return{icon:"./images/icon.svg",text:o,subtext:e.localizeKey("google_drive_folder"),...r.url&&{thumbnail:r.url}};const u=n&&!["application/vnd.google-apps.document"].includes(s);return{icon:"./images/icon.svg",text:o,subtext:((t,i)=>{if(l)return K(l);if(i.startsWith("application/vnd.google-apps."))switch(i.replace("application/vnd.google-apps.","")){case"document":return e.localizeKey("google_docs");case"spreadsheet":return e.localizeKey("google_sheets");case"presentation":return e.localizeKey("google_slides");case"form":return e.localizeKey("google_forms");case"drawing":return e.localizeKey("google_drawings");case"map":return e.localizeKey("google_my_maps");case"site":return e.localizeKey("google_sites");case"script":return e.localizeKey("google_apps_script");case"jam":return e.localizeKey("google_jamboard");default:return""}return""})(0,s),...r.url&&{thumbnail:r.url},...u&&{actions:[{text:e.localizeKey("download"),url:n}]}}},"remove-data":async e=>{const t=await h(e);await fetch(`https://oauth2.googleapis.com/revoke?token=${t}`,{method:"POST"}),sessionStorage.clear()},"show-settings":e=>e.popup({title:e.localizeKey("google_drive"),url:"auth-status.html"})},{targetOrigin:"https://trello.com",localization:T,Sentry:window.Sentry});
//# sourceMappingURL=index.b6efdea5.js.map
